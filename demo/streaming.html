<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tone.js JSON Sequencer - NDJSONã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ‡ãƒ¢</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    /* Additional CSS variables for streaming demo elements */
    :root {
      --status-bg: #f0f0f0;
      --info-bg: #e8f4f8;
      --info-border: #2196F3;
      --hint-bg: #fff3cd;
      --hint-border: #ffc107;
      --hint-text: #333333;
    }
    
    @media (prefers-color-scheme: dark) {
      :root {
        --status-bg: #2d2d30;
        --info-bg: #2d2d30;
        --info-border: #0078d4;
        --hint-bg: #3d3420;
        --hint-border: #8b7033;
        --hint-text: #ffffff;
      }
    }
    
    .streaming-controls {
      margin: 20px 0;
      display: flex;
      gap: 10px;
      align-items: center;
    }
    
    .streaming-controls button {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }
    
    .streaming-controls label {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .status {
      margin: 10px 0;
      padding: 10px;
      background: var(--status-bg);
      color: var(--text-color);
      border-radius: 4px;
      font-family: monospace;
    }
    
    .info {
      margin: 20px 0;
      padding: 15px;
      background: var(--info-bg);
      color: var(--text-color);
      border-left: 4px solid var(--info-border);
      border-radius: 4px;
    }
    
    .info h3 {
      margin-top: 0;
      color: var(--text-color);
    }
    
    .info ul {
      margin: 10px 0;
      padding-left: 20px;
    }
    
    .debug-section {
      margin: 20px 0;
    }
    
    .debug-controls {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-bottom: 10px;
    }
    
    #debugOutput {
      display: none;
      background: var(--status-bg);
      color: var(--text-color);
      border: 1px solid #444;
      border-radius: 4px;
      padding: 10px;
      font-family: monospace;
      font-size: 12px;
      height: 300px;
      overflow-y: auto;
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    .hint-box {
      margin-top: 10px;
      padding: 10px;
      background: var(--hint-bg);
      color: var(--hint-text);
      border-left: 4px solid var(--hint-border);
      border-radius: 4px;
    }

    .collapsible-section {
      margin: 20px 0;
    }

    .collapsible-header {
      display: flex;
      align-items: center;
      cursor: pointer;
      padding: 10px;
      background: var(--info-bg);
      border-left: 4px solid var(--info-border);
      border-radius: 4px;
      user-select: none;
    }

    .collapsible-header:hover {
      opacity: 0.9;
    }

    .collapsible-header:focus {
      outline: 2px solid var(--info-border);
      outline-offset: 2px;
    }

    .collapsible-header h3 {
      margin: 0;
      color: var(--text-color);
    }

    .collapsible-indicator {
      margin-right: 10px;
      font-size: 18px;
      transition: transform 0.3s ease;
    }

    .collapsible-indicator.collapsed {
      transform: rotate(-90deg);
    }

    .collapsible-content {
      display: none;
      padding: 15px;
      background: var(--info-bg);
      color: var(--text-color);
      border-left: 4px solid var(--info-border);
      border-radius: 0 0 4px 4px;
      margin-top: -4px;
    }

    .collapsible-content.expanded {
      display: block;
    }
  </style>
</head>
<body>
  <h1>NDJSONã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ‡ãƒ¢</h1>
  
  <p style="margin: 10px 0;">
    <a href="index.html">â† ãƒ¡ã‚¤ãƒ³ãƒ‡ãƒ¢ã«æˆ»ã‚‹</a> | 
    <a href="offline-rendering.html">ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ‡ãƒ¢ â†’</a>
  </p>
  
  <div class="collapsible-section">
    <div class="collapsible-header" id="aboutHeader" tabindex="0" role="button" aria-expanded="false" aria-controls="aboutSection">
      <span class="collapsible-indicator collapsed" id="aboutIndicator">â–¼</span>
      <h3>ã“ã®ãƒ‡ãƒ¢ã«ã¤ã„ã¦</h3>
    </div>
    <div class="collapsible-content" id="aboutSection">
      <p><strong>ğŸµ Streamingï¼ˆã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å†ç”Ÿï¼‰æ–¹å¼</strong></p>
      <ul>
        <li><strong>ãƒ©ã‚¤ãƒ–ç·¨é›†:</strong> å†ç”Ÿä¸­ã«ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã§ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’ç·¨é›† - å¤‰æ›´ã¯ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã«åæ˜ ã•ã‚Œã¾ã™</li>
        <li><strong>ãƒ«ãƒ¼ãƒ—å†ç”Ÿ:</strong> ãƒ«ãƒ¼ãƒ—ãƒ¢ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã¨ã€ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’é€£ç¶šå†ç”Ÿã§ãã¾ã™</li>
        <li><strong>50mså…ˆèª­ã¿:</strong> ã‚¹ãƒ ãƒ¼ã‚ºãªå†ç”Ÿã®ãŸã‚ã€ã‚¤ãƒ™ãƒ³ãƒˆã¯50msã®å…ˆèª­ã¿ã§ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã•ã‚Œã¾ã™</li>
        <li><strong>ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰:</strong> è©³ç´°ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¨ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°æƒ…å ±ã‚’ç¢ºèªã§ãã¾ã™</li>
      </ul>
      <div class="hint-box">
        <strong>ğŸ’¡ ãƒ’ãƒ³ãƒˆ:</strong> ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å…¨ä½“ã‚’ä¸€æ‹¬ã§ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹å ´åˆã¯ã€<a href="offline-rendering.html">ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ‡ãƒ¢</a>ã‚’ã”åˆ©ç”¨ãã ã•ã„ï¼ˆOne-shotæ–¹å¼ï¼‰
      </div>
    </div>
  </div>

  <div class="collapsible-section">
    <div class="collapsible-header" id="usageHeader" tabindex="0" role="button" aria-expanded="false" aria-controls="usageSection">
      <span class="collapsible-indicator collapsed" id="usageIndicator">â–¼</span>
      <h3>ä½¿ã„æ–¹</h3>
    </div>
    <div class="collapsible-content" id="usageSection">
      <ol>
        <li><strong>å†ç”Ÿ:</strong> ã€Œå†ç”Ÿã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€50msã®å…ˆèª­ã¿ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ã§å†ç”ŸãŒé–‹å§‹ã•ã‚Œã¾ã™</li>
        <li><strong>ãƒ©ã‚¤ãƒ–ç·¨é›†:</strong> å†ç”Ÿä¸­ã«ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã§ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’ç·¨é›† - å¤‰æ›´ã¯å³åº§ã«åæ˜ ã•ã‚Œã¾ã™</li>
        <li><strong>ãƒ«ãƒ¼ãƒ—:</strong> ã€Œãƒ«ãƒ¼ãƒ—å†ç”Ÿã€ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã¨ã€ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’é€£ç¶šçš„ã«ç¹°ã‚Šè¿”ã—å†ç”Ÿã§ãã¾ã™</li>
        <li><strong>ãƒ‡ãƒãƒƒã‚°:</strong> ã€Œãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã€ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã¨ã€ã‚¤ãƒ™ãƒ³ãƒˆã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ã¨ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®è©³ç´°æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</li>
        <li><strong>åœæ­¢:</strong> ã€Œåœæ­¢ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€å†ç”ŸãŒåœæ­¢ã—ã¦ãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™</li>
      </ol>
      <p><strong>ğŸ“ Note:</strong> ã“ã®æ–¹å¼ã¯<strong>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å†ç”Ÿ</strong>ã§ã™ã€‚ãƒ©ã‚¤ãƒ–ç·¨é›†ã‚„é€£ç¶šå†ç”ŸãŒå¯èƒ½ã§ã€å¯¾è©±çš„ãªéŸ³æ¥½åˆ¶ä½œã«æœ€é©ã§ã™ã€‚</p>
    </div>
  </div>

  <div class="streaming-controls">
    <button id="playButton" autofocus>å†ç”Ÿ</button>
    <button id="stopButton">åœæ­¢</button>
    <label>
      <input type="checkbox" id="loopCheckbox" checked>
      ãƒ«ãƒ¼ãƒ—å†ç”Ÿ
    </label>
    <label>
      <input type="checkbox" id="debugCheckbox">
      ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰
    </label>
    <select id="sequenceSelector">
      <!-- Options populated by JavaScript -->
    </select>
  </div>

  <div class="streaming-controls">
    <label style="font-weight: bold; margin-right: 10px;">ç·¨é›†ã®åæ˜ æ–¹å¼:</label>
    <label>
      <input type="radio" name="updateMode" id="updateModeManual" value="manual">
      CTRL+Sã‹SHIFT+ENTERã§åæ˜ 
    </label>
    <label>
      <input type="radio" name="updateMode" id="updateModeDebounce" value="debounce" checked>
      ãƒ‡ãƒã‚¦ãƒ³ã‚¹1ç§’ã§åæ˜ 
    </label>
  </div>

  <div class="status" id="status">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: åœæ­¢ä¸­</div>

  <div class="debug-section">
    <div class="debug-controls">
      <h3>ã‚¿ã‚¤ãƒŸãƒ³ã‚°å¯è¦–åŒ–:</h3>
    </div>
    <div id="timingVisualization" style="display: none; background: var(--status-bg); color: var(--text-color); border: 1px solid #444; border-radius: 4px; padding: 15px; margin-bottom: 15px; font-family: monospace; font-size: 14px;">
      <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
        <div>
          <div style="font-weight: bold; margin-bottom: 5px;">ğŸ“Š ã‚¤ãƒ™ãƒ³ãƒˆã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°:</div>
          <div id="eventSchedulingStats">-</div>
        </div>
        <div>
          <div style="font-weight: bold; margin-bottom: 5px;">ğŸ”„ ãƒ«ãƒ¼ãƒ—ã‚¿ã‚¤ãƒŸãƒ³ã‚°:</div>
          <div id="loopTimingStats">-</div>
        </div>
      </div>
      <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #444;">
        <div style="font-weight: bold; margin-bottom: 5px;">å‡¡ä¾‹:</div>
        <div style="font-size: 12px;">
          âšª = ã‚¿ã‚¤ãƒŸãƒ³ã‚°æ­£å¸¸ (Â±1msä»¥å†…) | ğŸ”´ = é…å»¶ | ğŸŸ¢ = æ—©ã„ | 
          âœ… = ãƒ«ãƒ¼ãƒ—æ­£å¸¸ (Â±5msä»¥å†…) | âš ï¸ = ãƒ«ãƒ¼ãƒ—é…å»¶ | â© = ãƒ«ãƒ¼ãƒ—æ—©ã„
        </div>
      </div>
    </div>
  </div>

  <div class="debug-section">
    <div class="debug-controls">
      <h3>ãƒ‡ãƒãƒƒã‚°å‡ºåŠ›:</h3>
      <button id="clearDebugButton">ãƒ‡ãƒãƒƒã‚°ã‚’ã‚¯ãƒªã‚¢</button>
    </div>
    <pre id="debugOutput"></pre>
  </div>

  <h3>ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ï¼ˆNDJSONå½¢å¼ - 1è¡Œã«ã¤ã1ã‚¤ãƒ™ãƒ³ãƒˆï¼‰:</h3>
  <textarea id="sequenceEditor" rows="30" cols="80"></textarea>

  <script src="https://unpkg.com/tone@15.2.7/build/Tone.js"></script>
  <script type="module" src="./dist/demo/streaming.js"></script>
  <script>
    function toggleSection(sectionId) {
      const section = document.getElementById(sectionId);
      const header = document.getElementById(sectionId.replace('Section', 'Header'));
      const indicator = document.getElementById(sectionId.replace('Section', 'Indicator'));
      
      const isExpanded = section.classList.contains('expanded');
      
      if (isExpanded) {
        section.classList.remove('expanded');
        indicator.classList.add('collapsed');
        header.setAttribute('aria-expanded', 'false');
      } else {
        section.classList.add('expanded');
        indicator.classList.remove('collapsed');
        header.setAttribute('aria-expanded', 'true');
      }
    }

    // Add event listeners for collapsible sections
    document.addEventListener('DOMContentLoaded', function() {
      const aboutHeader = document.getElementById('aboutHeader');
      const usageHeader = document.getElementById('usageHeader');

      // Click event listeners
      aboutHeader.addEventListener('click', function() {
        toggleSection('aboutSection');
      });

      usageHeader.addEventListener('click', function() {
        toggleSection('usageSection');
      });

      // Keyboard event listeners
      aboutHeader.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          toggleSection('aboutSection');
        }
      });

      usageHeader.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          toggleSection('usageSection');
        }
      });
    });
  </script>
</body>
</html>
